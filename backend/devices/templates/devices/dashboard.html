<!DOCTYPE html>
<html>
<head>
    <title>å·¥ä¸š AIoT å®æ—¶ç›‘æ§å¹³å°</title>
    <!-- å¼•å…¥ ECharts å›¾è¡¨åº“ CDN -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        body { background-color: #0d1117; color: #fff; font-family: sans-serif; }
        .container { width: 90%; margin: 50px auto; }
        h1 { text-align: center; color: #58a6ff; }
        #main { width: 100%; height: 500px; background: #161b22; border-radius: 10px; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ­ å·¥ä¸š AIoT å“¨å…µç³»ç»Ÿ - å®æ—¶ç›‘æ§</h1>
        <!-- å›¾è¡¨å®¹å™¨ -->
        <div id="main"></div>
    </div>

    <script type="text/javascript">
        // 1. åˆå§‹åŒ–å›¾è¡¨
        var myChart = echarts.init(document.getElementById('main'));

        // 2. é…ç½®å›¾è¡¨æ ·å¼
        var option = {
            title: { text: 'è®¾å¤‡ SIM001 - æ ¸å¿ƒæ¸©åº¦ç›‘æ§', left: 'center', textStyle: { color: '#fff' } },
            tooltip: { trigger: 'axis' },
            xAxis: { type: 'category', data: [], axisLabel: { color: '#8b949e' } },
            yAxis: { type: 'value', name: 'æ¸©åº¦ (Â°C)', axisLabel: { color: '#8b949e' }, splitLine: { lineStyle: { color: '#30363d' } } },
            series: [{
                data: [],
                type: 'line',
                smooth: true,
                areaStyle: { opacity: 0.3 },
                itemStyle: { color: '#58a6ff' },
                lineStyle: { width: 3 }
            }]
        };
        myChart.setOption(option);

        // 3. å®šæ—¶å»åç«¯æ‹‰å–æ•°æ® (æ ¸å¿ƒé€»è¾‘)
        function fetchData() {
            fetch('/api/v1/dashboard/data/?uid=SIM001')
                .then(response => response.json())
                .then(data => {
                    // æ›´æ–°å›¾è¡¨æ•°æ®
                    myChart.setOption({
                        xAxis: { data: data.times },
                        series: [{ data: data.temps }]
                    });
                });
        }

        // æ¯ 2000 æ¯«ç§’ (2ç§’) æ‰§è¡Œä¸€æ¬¡ fetchData
        setInterval(fetchData, 2000);
        
        // é¦–æ¬¡åŠ è½½ç«‹å³æ‰§è¡Œä¸€æ¬¡
        fetchData();
    </script>
</body>
</html>